#include "mavlink_if.h"

extern UART_HandleTypeDef huart2;
static uint8_t tx_buf[300];

void mavlink_init(void) {}

void mavlink_send_heartbeat(void)
{
    mavlink_message_t msg;
    mavlink_msg_heartbeat_pack(
        MAV_SYS_ID, MAV_COMP_ID, &msg,
        MAV_TYPE_QUADROTOR,
        MAV_AUTOPILOT_GENERIC,
        0, 0, MAV_STATE_ACTIVE
    );
    uint16_t len = mavlink_msg_to_send_buffer(tx_buf, &msg);
    HAL_UART_Transmit_IT(&huart2, tx_buf, len);
}

void mavlink_send_attitude(float r, float p, float y)
{
    mavlink_message_t msg;
    mavlink_msg_attitude_pack(
        MAV_SYS_ID, MAV_COMP_ID, &msg,
        HAL_GetTick(), r, p, y, 0, 0, 0
    );
    uint16_t len = mavlink_msg_to_send_buffer(tx_buf, &msg);
    HAL_UART_Transmit_IT(&huart2, tx_buf, len);
}
